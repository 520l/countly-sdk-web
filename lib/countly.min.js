(function(b){function M(){if(B){A||C();var a={name:B,segment:A};b.add_event({key:"[CLY]_view",dur:j()-D,segmentation:a});B=null}}function s(a){if(!b.ignore_bots||!N)if(!b.app_key||!b.device_id)k("app_key or device_id is missing");else{a.app_key=b.app_key;a.device_id=b.device_id;b.country_code&&(a.country_code=b.country_code);b.city&&(a.city=b.city);null!==b.ip_address&&(a.ip_address=b.ip_address);a.timestamp=j();var c=new Date;a.hour=c.getHours();a.dow=c.getDay();x.push(a);r("cly_queue",x,!0)}}function F(){if("undefined"!==
typeof b.q&&0<b.q.length){for(var a,c=0;c<b.q.length;c++)if(a=b.q[c],k("Processing queued call",a),"function"===typeof a)a();else if(a.constructor===Array&&0<a.length)if("undefined"!==typeof b[a[0]])b[a[0]].apply(null,a.slice(1));else{var f=a[0].replace("userData.","");"undefined"!==typeof b.userData[f]&&b.userData[f].apply(null,a.slice(1))}b.q=[]}z&&(O&&G)&&(a=j(),60<a-y&&(b.session_duration(a-y),y=a));0<t.length&&(10>=t.length?(s({events:JSON.stringify(t)}),t=[]):(a=t.splice(0,10),s({events:JSON.stringify(a)})),
r("cly_event",t));if(0<x.length&&H&&j()>P){H=!1;var e=x.shift();k("Processing request",e);var i=function(a,d){k("Request Finished",d,a);a&&(x.unshift(d),P=j()+I);r("cly_queue",x,!0);H=!0};try{k("Sending XML HTTP request");var g=window.XMLHttpRequest?new window.XMLHttpRequest:window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):null;g.open("GET",b.url+Z+"?"+$(e),!0);g.onreadystatechange=function(){4===this.readyState&&200<=this.status&&300>this.status?"function"===typeof i&&i(!1,e):4===this.readyState&&
(k("Failed Server XML HTTP request",this.status),"function"===typeof i&&i(!0,e))};g.send()}catch(h){k("Failed XML HTTP request",h),"function"===typeof i&&i(!0,e)}}setTimeout(F,J)}function C(){var a={};a._app_version=b.app_version;screen.width&&(a._resolution=""+(screen.width?screen.width:"")+"x"+(screen.height?screen.height:""));for(var c=navigator.appVersion,f=navigator.userAgent,e=navigator.appName,i,g,h=[["Opera Mini","Opera Mini"],["Opera","Opera"],["OPR","Opera"],["MSIE","Internet Explorer"],
["IEMobile","IE Mobile"],["Edge","Edge"],["Chromium","Chromium"],["FxiOS","Firefox"],["Trident","Internet Explorer"],["FBAV/","Facebook app"],["baiduboxapp/","Baidu Box App"],["baidubrowser/","Baidu Browser"],["Dolfin","Dolfin"],["Skyfire","Skyfire"],["bolt","Bolt"],["teashark","TeaShark"],["Blazer","Blazer"],["Tizen","Tizen"],["UCWEB","UCBrowser"],["UC.","UCBrowser"],["DiigoBrowser","DiigoBrowser"],["Puffin","Puffin"],["Mercury","Mercury"],["Obigo","ObigoBrowser"],["NF-Browser","NetFront"],["amaya",
"Amaya"],["Arora","Arora"],["Avant","Avant"],["BlackBerry","BlackBerry"],["RIM","BlackBerry"],["CFNetwork","CFNetwork"],["Camino","Camino"],["Coast","Coast"],["Dalvik","Dalvik"],["Dillo","Dillo"],["DoCoMo","DoCoMo"],["ELinks","ELinks"],["Espial","Espial TV Browser"],["FlyFlow","FlyFlow"],["GSA","Google App"],["Google Desktop","Google Desktop"],["GooglePlus","Google+ App"],["IBrowse","IBrowse"],["Jasmine","Jasmine"],["Kindle","Kindle"],["Konqueror","Konqueror"],["Links","Links"],["Lotus-Notes","Lotus Notes"],
["Lynx","Lynx"],["WAP","WAP Browser"],["MiuiBrowser","Miui Browser"],["Nokia","Nokia"],["OneBrowser","OneBrowser"],["Outlook","Outlook"],["Palm","Palm"],["Pinterest","Pinterest App"],["Playstation","Playstation"],["PlayStation","Playstation"],["PLAYSTATION","Playstation"],["Polaris","Polaris"],["QQ","QQbrowser"],["Qt","Qt"],["QuickTime","QuickTime"],["SEMC-Browser","SEMC Browser"],["SamsungBrowser","Samsung Browser"],["SeaMonkey","SeaMonkey"],["Sleipnir","Sleipnir"],["SmartTV","SmartTV WebBrowser"],
["Viera","SmartViera"],["Thunderbird","Thunderbird"],["Vivaldi","Vivaldi"],["wOSBrowser","webOS"],["WebTV","WebTV"],["wp-","WordPress App"],["YaBrowser","Yandex Browser"],["iCab","iCab"],["iTunes","iTunes"],["rekonq","rekonq"],["rekonq","rekonq"],["Chrome","Chrome"],["Firefox","Firefox"],["Android","Android"],["Safari","Safari"],["iPhone","Safari"]],l=0;l<h.length;l++)if(-1!=f.indexOf(h[l][0])){e=h[l][1];break}if(!e&&(i=f.lastIndexOf(" ")+1)<(g=f.lastIndexOf("/")))e=f.substring(i,g),e.toLowerCase()==
e.toUpperCase()&&(e=navigator.appName);a._browser=e;e="unknown";i=[{s:"Xbox",r:/Xbox/},{s:"Windows 3.11",r:/Win16/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},
{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 10",r:/(Windows NT 10.0)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows ME",r:/Windows ME/},{s:"Windows Phone",r:/Windows Phone/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OSX",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",
r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"SearchBot",r:Q}];for(var d in i)if(g=i[d],g.r.test(f)){e=g.s;break}d="unknown";/Windows/.test(e)&&"Windows Phone"!=e&&(d=/Windows (.*)/.exec(e)[1],e="Windows");switch(e){case "Mac OSX":d=/Mac OS X (10[\.\_\d]+)/.exec(f)[1];break;case "Windows Phone":d=(/Windows Phone ([\.\_\d]+)/.exec(f)||["","8.0"])[1];break;case "Android":d=/Android ([\.\_\d]+)/.exec(f)[1];break;case "iOS":d=/OS (\d+)_(\d+)_?(\d+)?/.exec(c),d=d[1]+"."+d[2]+
"."+(d[3]|0)}A=a._os=e;a._os_version=d;c=navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage;"undefined"!==typeof c&&(a._locale=c);if("undefined"!==typeof document.referrer&&document.referrer.length&&(c=R.exec(document.referrer))&&c[11]&&c[11]!=window.location.hostname)a._store=document.referrer;k("Got metrics",a);return a}function k(){b.debug&&"undefined"!==typeof console&&(arguments[1]&&"object"==typeof arguments[1]&&(arguments[1]=JSON.stringify(arguments[1])),
console.log(Array.prototype.slice.call(arguments).join("\n")))}function j(){return Math.floor((new Date).getTime()/1E3)}function K(a,c,b){var b=b||S,e="";"object"===typeof a?"undefined"!==typeof a.stack?e=a.stack:("undefined"!==typeof a.name&&(e+=a.name+":"),"undefined"!==typeof a.message&&(e+=a.message+"\n"),"undefined"!==typeof a.fileName&&(e+="in "+a.fileName+"\n"),"undefined"!==typeof a.lineNumber&&(e+="on "+a.lineNumber),"undefined"!==typeof a.columnNumber&&(e+=":"+a.columnNumber)):e=a+"";var c=
c?!0:!1,a=C(),e={_os:a._os,_os_version:a._os_version,_resolution:a._resolution,_error:e,_app_version:a._app_version,_run:j()-T,_not_os_specific:!0},i=navigator.battery||navigator.webkitBattery||navigator.mozBattery||navigator.msBattery;i&&(e._bat=Math.floor(100*i.level));"undefined"!==typeof navigator.onLine&&(e._online=navigator.onLine?!0:!1);e._background=document.hasFocus()?!1:!0;0<E.length&&(e._logs=E.join("\n"));E=[];e._nonfatal=c;e._view=(window.location.pathname||"")+(window.location.search||
"")+(window.location.hash||"");e._browser=a._browser;"undefined"!==typeof b&&(e._custom=b);try{var g=document.createElement("canvas").getContext("experimental-webgl");e._opengl=g.getParameter(g.VERSION)}catch(h){}s({crash:JSON.stringify(e)})}function $(a){var c=[],b;for(b in a)c.push(b+"="+encodeURIComponent(a[b]));return c.join("&")}function U(a,c){for(var b={},e,i=0;i<c.length;i++)e=c[i],"undefined"!==typeof a[e]&&(b[e]=a[e]);return b}function V(a){"undefined"==typeof a.pageY&&("number"==typeof a.clientX&&
document.documentElement)&&(a.pageX=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,a.pageY=a.clientY+document.body.scrollTop+document.documentElement.scrollTop);return a}var W=!1,z=!1,Z="/i",J=500,x=[],t=[],E=[],w={},S=null,O=!0,y,X=0,B=null,D=0,L=0,P=0,I=60,H=!0,A,R=/^(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/,Q=/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver|bingbot|Google Web Preview|Mediapartners-Google|AdsBot-Google|Baiduspider|Ezooms|YahooSeeker|AltaVista|AVSearch|Mercator|Scooter|InfoSeek|Ultraseek|Lycos|Wget|YandexBot|Yandex|YaDirectFetcher|SiteBot|Exabot|AhrefsBot|MJ12bot|TurnitinBot|magpie-crawler|Nutch Crawler|CMS Crawler|rogerbot|Domnutch|ssearch_bot|XoviBot|netseer|digincore|fr-crawler|wesee|AliasIO)/,
N=!1,G=!0,T;b.init=function(a){if(!W){T=j();W=!0;x=r("cly_queue")||[];w=r("cly_timed")||{};t=r("cly_event")||[];a=a||{};J=a.interval||b.interval||J;I=a.fail_timeout||b.fail_timeout||I;b.debug=a.debug||b.debug||!1;b.app_key=a.app_key||b.app_key||null;var c=b,f;if(!(f=a.device_id))if(!(f=b.device_id))if(!(f=r("cly_id"))){var e=(new Date).getTime();f="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var c=(e+16*Math.random())%16|0;e=Math.floor(e/16);return("x"==a?c:c&3|8).toString(16)})}c.device_id=
f;c=b;f=a.url||b.url||"https://cloud.count.ly";f="/"==f.substr(f.length-1)?f.substr(0,f.length-1):f;c.url=f;b.app_version=a.app_version||b.app_version||"0.0";b.country_code=a.country_code||b.country_code||null;b.city=a.city||b.city||null;b.ip_address=a.ip_address||b.ip_address||null;b.ignore_bots=a.ignore_bots||b.ignore_bots||!0;b.q=b.q||[];k("Countly initialized");Q.test(navigator.userAgent)&&(N=!0);b.q.constructor!==Array&&(b.q=[]);F();r("cly_id",b.device_id);if(location.search){a=location.search.substring(1).split("&");
for(c=0;c<a.length;c++)f=a[c].split("="),"cly_id"==f[0]?r("cly_cmp_id",f[1]):"cly_uid"==f[0]&&r("cly_cmp_uid",f[1])}}};b.begin_session=function(a){z||(k("Session started"),y=j(),z=!0,O=a?!1:!0,a={begin_session:1},a.metrics=JSON.stringify(C()),s(a))};b.session_duration=function(a){z&&(k("Session extended",a),s({session_duration:a}))};b.end_session=function(a){z&&(a=a||j()-y,k("Ending session"),M(),z=!1,s({end_session:1,session_duration:a}),F())};b.change_id=function(a,c){var f=b.device_id;b.device_id=
a;r("cly_id",b.device_id);k("Changing id");c&&s({old_device_id:f})};b.add_event=function(a){if(a.key){a.count||(a.count=1);var c=U(a,["key","count","sum","dur","segmentation"]);c.timestamp=j();var b=new Date;c.hour=b.getHours();c.dow=b.getDay();t.push(c);r("cly_event",t);k("Adding event: ",a)}else k("Event must have key property")};b.start_event=function(a){w[a]?k("Timed event with key "+a+" already started"):(w[a]=j(),r("cly_timed",w))};b.end_event=function(a){"string"==typeof a&&(a={key:a});a.key?
w[a.key]?(a.dur=j()-w[a.key],b.add_event(a),delete w[a.key],r("cly_timed",w)):k("Timed event with key "+key+" was not started"):k("Event must have key property")};b.user_details=function(a){k("Adding userdetails: ",a);s({user_details:JSON.stringify(U(a,"name username email organization phone picture gender byear custom".split(" ")))})};b.report_conversion=function(a,c){a=a||r("cly_cmp_id");c=c||r("cly_cmp_uid");a&&c?s({campaign_id:a,campaign_user:c}):a?s({campaign_id:a}):k("No campaign data found")};
var u={},v=function(a,c,b){u[a]||(u[a]={});"$push"==b||"$pull"==b||"$addToSet"==b?(u[a][b]||(u[a][b]=[]),u[a][b].push(c)):u[a][b]=c};b.userData={set:function(a,c){u[a]=c},set_once:function(a){v(a,1,"$setOnce")},increment:function(a){v(a,1,"$inc")},increment_by:function(a,c){v(a,c,"$inc")},multiply:function(a,c){v(a,c,"$mul")},max:function(a,c){v(a,c,"$max")},min:function(a,c){v(a,c,"$min")},push:function(a,c){v(a,c,"$push")},push_unique:function(a,c){v(a,c,"$addToSet")},pull:function(a,c){v(a,c,"$pull")},
save:function(){s({user_details:JSON.stringify({custom:u})});u={}}};b.track_errors=function(a){S=a;window.onerror=function(a,b,e,i,g){if("undefined"!==typeof g)K(g,!1);else{var i=i||window.event&&window.event.errorCharacter,h="";"undefined"!==typeof a&&(h+=a+"\n");"undefined"!==typeof b&&(h+="at "+b);"undefined"!==typeof e&&(h+=":"+e);"undefined"!==typeof i&&(h+=":"+i);h+="\n";try{for(var l=[],d=arguments.callee.caller;d;)l.push(d.name),d=d.caller;h+=l.join("\n")}catch(k){}K(h,!1)}}};b.log_error=
function(a,b){K(a,!0,b)};b.add_log=function(a){E.push(a)};b.stop_time=function(){G=!1;X=j()-y;L=j()-D};b.start_time=function(){G=!0;y=j()-X;D=j()-L;L=0};b.track_sessions=function(){function a(){document[c]?b.stop_time():b.start_time()}b.begin_session();b.start_time();q(window,"beforeunload",function(){b.end_session()});q(window,"unload",function(){b.end_session()});var c="hidden";c in document?document.addEventListener("visibilitychange",a):(c="mozHidden")in document?document.addEventListener("mozvisibilitychange",
a):(c="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",a):(c="msHidden")in document?document.addEventListener("msvisibilitychange",a):"onfocusin"in document?(q(window,"focusin",function(){b.start_time()}),q(window,"focusout",function(){b.stop_time()})):(q(window,"focus",function(){b.start_time()}),q(window,"blur",function(){b.stop_time()}),q(window,"pageshow",function(){b.start_time()}),q(window,"pagehide",function(){b.stop_time()}))};b.track_pageview=function(a){M();
B=a=a||window.location.pathname;D=j();A||C();a={name:a,visit:1,segment:A,domain:window.location.hostname};if("undefined"!==typeof document.referrer&&document.referrer.length){var c=R.exec(document.referrer);c&&(c[11]&&c[11]!=window.location.hostname)&&(a.start=1)}b.add_event({key:"[CLY]_view",segmentation:a})};b.track_view=function(a){b.track_pageview(a)};b.track_clicks=function(a){function c(a){if(f){f=!1;V(a);if("undefined"!==typeof a.pageX&&"undefined"!==typeof a.pageY){var c;c=document;c=Math.max(Math.max(c.body.scrollHeight,
c.documentElement.scrollHeight),Math.max(c.body.offsetHeight,c.documentElement.offsetHeight),Math.max(c.body.clientHeight,c.documentElement.clientHeight));var g;g=document;g=Math.max(Math.max(g.body.scrollWidth,g.documentElement.scrollWidth),Math.max(g.body.offsetWidth,g.documentElement.offsetWidth),Math.max(g.body.clientWidth,g.documentElement.clientWidth));b.add_event({key:"[CLY]_action",segmentation:{type:"click",x:a.pageX,y:a.pageY,width:g,height:c,domain:window.location.hostname}})}setTimeout(function(){f=
!0},1E3)}}var a=a||document,f=!0;q(a,"mousedown",c);q(a,"mouseup",c);q(a,"click",c)};b.track_links=function(a){function c(){function c(a){var e;e=a?"undefined"!==typeof a.target?a.target:a.srcElement:window.event.srcElement;V(a);b.add_event({key:"linkClick",segmentation:{href:e.href,text:e.innerText,id:e.id,x:a.pageX,y:a.pageY}});"undefined"!==typeof e.href&&("_blank"!==e.target&&!a.metaKey&&!a.altKey&&!a.ctrlKey&&!a.shiftKey)&&0!==e.href.replace(window.location.href.split("#")[0],"").indexOf("#")&&
(b.end_session(),Y(a),setTimeout(function(){window.location.href=e.href},1E3))}if("undefined"!==typeof a.getElementsByTagName)for(var e=a.getElementsByTagName("a"),i=0;i<e.length;i++)q(e[i],"click",c);else k("Can't track clicks")}a=a||document;"complete"===document.readyState?c():q(window,"load",c)};b.track_forms=function(a){function c(a){return a.name||a.id||a.type||a.nodeName}function f(a){var e=!1;q(a,"submit",function(f){if(!e){e=!0;var l={id:a.id,name:a.name,action:a.action,method:a.method},
d;if("undefined"!==typeof a.elements)for(var k=0;k<a.elements.length;k++)if(d=a.elements[k],l["input:"+c(d)]=[],"select"==d.nodeName.toLowerCase())if("undefined"!==typeof d.multiple){var n=[];if("undefined"!==typeof d.options)for(var p=0;p<d.options.length;p++)d.options[p].selected&&n.push(d.options[p].value);l["input:"+c(d)].push(n.join(","))}else l["input:"+c(d)].push(d.options[d.selectedIndex].value);else"input"==d.nodeName.toLowerCase()?"undefined"!==typeof d.type?"checkbox"==d.type.toLowerCase()||
"radio"==d.type.toLowerCase()?d.checked&&l["input:"+c(d)].push(d.value):l["input:"+c(d)].push(d.value):l["input:"+c(d)].push(d.value):"textarea"==d.nodeName.toLowerCase()?l["input:"+c(d)].push(d.value):"undefined"!==typeof d.value&&l["input:"+c(d)].push(d.value);for(var m in l)"undefined"!=typeof l[m].join&&(l[m]=l[m].join(","));b.add_event({key:"formSubmit",segmentation:l});b.end_session();Y(f);setTimeout(function(){a.submit()},1E3)}})}function e(){if("undefined"!==typeof a.getElementsByTagName)for(var c=
a.getElementsByTagName("form"),b=0;b<c.length;b++)f(c[b]);else k("Can't track forms")}a=a||document;"complete"===document.readyState?e():q(window,"load",e)};b.collect_from_forms=function(a,c){function f(e){var f=!1;q(e,"submit",function(){if(!f){f=!0;var h={},l=!1,d;if("undefined"!==typeof e.elements){var j={},n=a.getElementsByTagName("LABEL"),p;for(p=0;p<n.length;p++)n[p].htmlFor&&""!==n[p].htmlFor&&(j[n[p].htmlFor]=n[p].innerText||n[p].textContent||n[p].innerHTML);for(p=0;p<e.elements.length;p++)if(d=
e.elements[p],-1==d.className.indexOf("cly_user_ignore")){var m="";if("select"==d.nodeName.toLowerCase())if("undefined"!==typeof d.multiple){m=[];if("undefined"!==typeof d.options)for(n=0;n<d.options.length;n++)d.options[n].selected&&m.push(d.options[n].value);m=m.join()}else m=d.options[d.selectedIndex].value;else"input"==d.nodeName.toLowerCase()?"undefined"!==typeof d.type?"checkbox"==d.type.toLowerCase()||"radio"==d.type.toLowerCase()?"undefined"!==typeof d.checked&&(m=d.value):m=d.value:m=d.value:
"textarea"==d.nodeName.toLowerCase()?m=d.value:"undefined"!==typeof d.value&&(m=d.value);if(d.className&&-1!=d.className.indexOf("cly_user_")){d=d.className.split(" ");for(n=0;n<d.length;n++)if(0===d[n].indexOf("cly_user_")){h[d[n].replace("cly_user_","")]=m;l=!0;break}}else if(d.type&&"email"==d.type.toLowerCase()||d.name&&-1!=d.name.toLowerCase().indexOf("email")||d.id&&-1!=d.id.toLowerCase().indexOf("email")||d.id&&j[d.id]&&-1!=j[d.id].toLowerCase().indexOf("email")||/[^@\s]+@[^@\s]+\.[^@\s]+/.test(m))h.email||
(h.email=m),l=!0;else if(d.name&&-1!=d.name.toLowerCase().indexOf("username")||d.id&&-1!=d.id.toLowerCase().indexOf("username")||d.id&&j[d.id]&&-1!=j[d.id].toLowerCase().indexOf("username"))h.username||(h.username=m),l=!0;else if(d.name&&(-1!=d.name.toLowerCase().indexOf("tel")||-1!=d.name.toLowerCase().indexOf("phone")||-1!=d.name.toLowerCase().indexOf("number"))||d.id&&(-1!=d.id.toLowerCase().indexOf("tel")||-1!=d.id.toLowerCase().indexOf("phone")||-1!=d.id.toLowerCase().indexOf("number"))||d.id&&
j[d.id]&&(-1!=j[d.id].toLowerCase().indexOf("tel")||-1!=j[d.id].toLowerCase().indexOf("phone")||-1!=j[d.id].toLowerCase().indexOf("number")))h.phone||(h.phone=m),l=!0;else if(d.name&&(-1!=d.name.toLowerCase().indexOf("org")||-1!=d.name.toLowerCase().indexOf("company"))||d.id&&(-1!=d.id.toLowerCase().indexOf("org")||-1!=d.id.toLowerCase().indexOf("company"))||d.id&&j[d.id]&&(-1!=j[d.id].toLowerCase().indexOf("org")||-1!=j[d.id].toLowerCase().indexOf("company")))h.organization||(h.organization=m),l=
!0;else if(d.name&&-1!=d.name.toLowerCase().indexOf("name")||d.id&&-1!=d.id.toLowerCase().indexOf("name")||d.id&&j[d.id]&&-1!=j[d.id].toLowerCase().indexOf("name"))h.name||(h.name=""),h.name+=m+" ",l=!0}}l&&(k("Gathered user data",h),c?b.user_details({custom:h}):b.user_details(h));b.end_session()}})}function e(){if("undefined"!==typeof a.getElementsByTagName)for(var c=a.getElementsByTagName("form"),b=0;b<c.length;b++)f(c[b]);else k("Can't track forms")}a=a||document;"complete"===document.readyState?
e():q(window,"load",e)};b.collect_from_facebook=function(a){FB&&FB.api&&FB.api("/me",function(c){var f={};c.name&&(f.name=c.name);c.email&&(f.email=c.email);"male"==c.gender?f.gender="M":"female"==c.gender&&(f.gender="F");if(c.birthday){var e=c.birthday.split("/").pop();e&&4==e.length&&(f.byear=e)}c.work&&(c.work[0]&&c.work[0].employer&&c.work[0].employer.name)&&(f.organization=c.work[0].employer.name);if(a){f.custom={};for(var i in a){for(var e=a[i].split("."),g=c,h=0;h<e.length&&!(g=g[e[h]],"undefined"===
typeof g);h++);"undefined"!==typeof g&&(f.custom[i]=g)}}b.user_details(f)})};var q=function(a,c,b){"undefined"!==typeof a.addEventListener?a.addEventListener(c,b,!1):a.attachEvent("on"+c,b)},Y=function(a){"undefined"!==typeof window.event?window.event.returnValue=!1:"undefined"!==typeof a.preventDefault?a.preventDefault():a.returnValue=!1},r=function(a,c,b){function e(a,b,c){var e=new Date;e.setTime(e.getTime()+864E5*c);c="; expires="+e.toGMTString();document.cookie=a+"="+b+c+"; path=/"}var b=b||
!1,i=!1,g;if("undefined"!==typeof localStorage){i=!0;try{localStorage.setItem("testLocal",!0)}catch(h){i=!1}}"undefined"!==typeof c&&null!==c&&("object"===typeof c&&(c=JSON.stringify(c)),i?localStorage.setItem(a,c):b||e(a,c,30));if("undefined"===typeof c){if(i)g=localStorage.getItem(a);else if(!b)a:{a+="=";c=document.cookie.split(";");b=0;for(i=c.length;b<i;b++){for(g=c[b];" "===g.charAt(0);)g=g.substring(1,g.length);if(0===g.indexOf(a)){g=g.substring(a.length,g.length);break a}}g=null}try{g=JSON.parse(g)}catch(j){}return g}null===
c&&(i?localStorage.removeItem(a):b||e(a,"",-1))}})(window.Countly=window.Countly||{});
