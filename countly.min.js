(function(b){function l(a){!b.app_key||!b.device_id?h("app_key or device_id is missing"):(a.app_key=b.app_key,a.device_id=b.device_id,b.country_code&&(a.country_code=b.country_code),b.city&&(a.city=b.city),b.ip_address&&(a.ip_address=b.ip_address),a.timestamp=p(),i.push(a),j("cly_queue",i,!0))}function q(){if(b.q&&0<b.q.length){for(var a,f=0;f<b.q.length;f++)if(a=b.q[f],a.constructor===Array&&0<a.length&&(h("Processing queued call",a),b[a[0]]))b[a[0]](a[1]);b.q=[]}m&&r&&(a=p(),30<a-n&&(b.session_duration(a-
n),n=a));0<k.length&&(10>=k.length?(l({events:JSON.stringify(k)}),k=[]):(k.splice(0,10),l({events:JSON.stringify(k)})));if(0<i.length){var c=i.shift();h("Processing request",c);var e=function(a,c){h("Request Finished",c,!1);a&&(i.unshift(c),j("cly_queue",i,!0))};try{h("Sending XML HTTP request");var g=window.XMLHttpRequest?new window.XMLHttpRequest:window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):null;g.open("GET",b.url+u+"?"+v(c),!0);g.onreadystatechange=function(){4===this.readyState&&
200<=this.status&&300>this.status?"function"===typeof e&&e(!1,c):4===this.readyState&&(h("Failed Server XML HTTP request",this.status),"function"===typeof e&&e(!0,c))};g.send()}catch(d){h("Failed XML HTTP request",d),"function"===typeof e&&e(!0,c)}j("cly_queue",i,!0)}setTimeout(q,w)}function x(){var a={};b.app_version&&(a._app_version=b.app_version);screen.width&&(a._resolution=""+(screen.width?screen.width:"")+"x"+(screen.height?screen.height:""));var f=navigator.userAgent,c=navigator.appName;parseFloat(navigator.appVersion);
var e,g;if(-1!=f.indexOf("Opera"))c="Opera";else if(-1!=f.indexOf("MSIE"))c="Internet Explorer";else if(-1!=f.indexOf("Chrome"))c="Chrome";else if(-1!=f.indexOf("Safari"))c="Safari";else if(-1!=f.indexOf("Firefox"))c="Firefox";else if(-1!=f.indexOf("Trident/"))c="Internet Explorer";else if((e=f.lastIndexOf(" ")+1)<(g=f.lastIndexOf("/")))c=f.substring(e,g),c.toLowerCase()==c.toUpperCase()&&(c=navigator.appName);a._carrier=c;c="unknown";e=[{s:"Windows 3.11",r:/Win16/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},
{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},
{s:"Windows ME",r:/Windows ME/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OSX",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"SearchBot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var d in e)if(g=e[d],g.r.test(f)){c=g.s;break}d="unknown";/Windows/.test(c)&&
(d=/Windows (.*)/.exec(c)[1],c="Windows");switch(c){case "Mac OSX":d=/Mac OS X (10[\.\_\d]+)/.exec(f)[1];break;case "Android":d=/Android ([\.\_\d]+)/.exec(f)[1];break;case "iOS":d=/OS (\d+)_(\d+)_?(\d+)?/.exec(nVer),d=d[1]+"."+d[2]+"."+(d[3]|0)}a._os=c;a._os_version=d;if(f=navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage)a._locale=f;h("Got metrics",a);return a}function h(){b.debug&&console&&console.log(Array.prototype.slice.call(arguments))}function p(){return Math.floor((new Date).getTime()/
1E3)}function v(a){var b=[],c;for(c in a)b.push(c+"="+encodeURIComponent(a[c]));return b.join("&")}function s(a,b){for(var c={},e,g=0;g<b.length;g++)e=b[g],a[e]&&(c[e]=a[e]);return c}var t=!1,m=!1,u="/i",w=1E3,i=[],k=[],r=!0,n;b.init=function(a){if(!t){t=!0;i=j("cly_queue")||[];a=a||{};b.debug=a.debug||b.debug||!1;b.app_key=a.app_key||b.app_key||null;var f=b,c;if(!(c=a.device_id))if(!(c=b.device_id)){if(!(c=j("cly_id"))){var e=(new Date).getTime();c="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,
function(a){var c=(e+16*Math.random())%16|0;e=Math.floor(e/16);return("x"==a?c:c&3|8).toString(16)})}j("cly_id",c)}f.device_id=c;f=b;c=a.url||b.url||"https://cloud.count.ly";c="/"==c.substr(c.length-1)?c.substr(0,c.length-1):c;f.url=c;b.app_version=a.app_version||b.app_version||null;b.country_code=a.country_code||b.country_code||null;b.city=a.city||b.city||null;b.ip_address=a.ip_address||b.ip_address||null;b.q=b.q||[];b.q.constructor!==Array&&(b.q=[]);q();h("Countly initialized")}};b.begin_session=
function(a){m||(h("Session started"),n=p(),m=!0,r=a?!1:!0,a={begin_session:1},j("cly_first_"+b.device_id)||(j("cly_first_"+b.device_id,!0),a.metrics=JSON.stringify(x())),l(a))};b.session_duration=function(a){m&&(h("Session extended",a),l({session_duration:a}))};b.end_session=function(){m&&(h("Ending session"),m=!1,l({end_session:1,session_duration:p()-n}))};b.add_event=function(a){a.key?(a.count||(a.count=1),k.push(s(a,["key","count","sum","segmentation"])),h("Adding event: ",a)):h("Event must have key property")};
b.user_details=function(a){h("Adding userdetails: ",a);l({user_details:JSON.stringify(s(a,"name username email organization phone picture gender byear custom".split(" ")))})};var j=function(a,b,c){function e(a,b,c){var d=new Date;d.setTime(d.getTime()+864E5*c);c="; expires="+d.toGMTString();document.cookie=a+"="+b+c+"; path=/"}var g=!1,d;localStorage&&(g=!0);"undefined"!==typeof b&&null!==b&&("object"===typeof b&&(b=JSON.stringify(b)),g?localStorage.setItem(a,b):c||e(a,b,30));if("undefined"===typeof b){if(g)d=
localStorage.getItem(a);else if(!c)a:{a+="=";b=document.cookie.split(";");c=0;for(g=b.length;c<g;c++){for(d=b[c];" "===d.charAt(0);)d=d.substring(1,d.length);if(0===d.indexOf(a)){d=d.substring(a.length,d.length);break a}}d=null}try{d=JSON.parse(d)}catch(h){}return d}null===b&&(g?localStorage.removeItem(a):c||e(a,"",-1))}})(window.Countly=window.Countly||{});
