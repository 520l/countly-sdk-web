(function(a){function k(b){!a.app_key||!a.device_id?h("app_key or device_id is missing"):(b.app_key=a.app_key,b.device_id=a.device_id,a.country_code&&(b.country_code=a.country_code),a.city&&(b.city=a.city),a.ip_address&&(b.ip_address=a.ip_address),b.timestamp=p(),j.push(b),i("cly_queue",j,!0))}function q(){if(a.q&&0<a.q.length){for(var b,e=0;e<a.q.length;e++)if(b=a.q[e],b.constructor===Array&&0<b.length&&(h("Processing queued call",b),a[b[0]]))a[b[0]](b[1]);a.q=[]}m&&r&&(b=p(),30<b-n&&(a.session_duration(b-
n),n=b));0<l.length&&(10>=l.length?(k({events:JSON.stringify(l)}),l=[]):(l.splice(0,10),k({events:JSON.stringify(l)})));if(0<j.length){var c=j.shift();h("Processing request",c);var f=function(b,a){h("Request Finished",a,!1);b&&(j.unshift(a),i("cly_queue",j,!0))};try{h("Sending XML HTTP request");var g=window.XMLHttpRequest?new window.XMLHttpRequest:window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):null;g.open("GET",a.url+u+"?"+v(c),!0);g.onreadystatechange=function(){4===this.readyState&&
200<=this.status&&300>this.status?"function"===typeof f&&f(!1,c):4===this.readyState&&(h("Failed Server XML HTTP request",this.status),"function"===typeof f&&f(!0,c))};g.send()}catch(d){h("Failed XML HTTP request",d),"function"===typeof f&&f(!0,c)}i("cly_queue",j,!0)}setTimeout(q,w)}function x(){var b={};a.app_version&&(b._app_version=a.app_version);screen.width&&(b._resolution=""+(screen.width?screen.width:"")+"x"+(screen.height?screen.height:""));var e=navigator.userAgent,c=navigator.appName;parseFloat(navigator.appVersion);
var f,g;if(-1!=e.indexOf("Opera"))c="Opera";else if(-1!=e.indexOf("MSIE"))c="Internet Explorer";else if(-1!=e.indexOf("Chrome"))c="Chrome";else if(-1!=e.indexOf("Safari"))c="Safari";else if(-1!=e.indexOf("Firefox"))c="Firefox";else if(-1!=e.indexOf("Trident/"))c="Internet Explorer";else if((f=e.lastIndexOf(" ")+1)<(g=e.lastIndexOf("/")))c=e.substring(f,g),c.toLowerCase()==c.toUpperCase()&&(c=navigator.appName);b._carrier=c;c="unknown";f=[{s:"Windows 3.11",r:/Win16/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},
{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},
{s:"Windows ME",r:/Windows ME/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OSX",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"SearchBot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var d in f)if(g=f[d],g.r.test(e)){c=g.s;break}d="unknown";/Windows/.test(c)&&
(d=/Windows (.*)/.exec(c)[1],c="Windows");switch(c){case "Mac OSX":d=/Mac OS X (10[\.\_\d]+)/.exec(e)[1];break;case "Android":d=/Android ([\.\_\d]+)/.exec(e)[1];break;case "iOS":d=/OS (\d+)_(\d+)_?(\d+)?/.exec(nVer),d=d[1]+"."+d[2]+"."+(d[3]|0)}b._os=c;b._os_version=d;if(e=navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage)b._locale=e;h("Got metrics",b);return b}function h(){a.debug&&console&&console.log(Array.prototype.slice.call(arguments))}function p(){return Math.floor((new Date).getTime()/
1E3)}function v(b){var a=[],c;for(c in b)a.push(c+"="+encodeURIComponent(b[c]));return a.join("&")}function s(b,a){for(var c={},f,g=0;g<a.length;g++)f=a[g],b[f]&&(c[f]=b[f]);return c}var t=!1,m=!1,u="/i",w=1E3,j=[],l=[],r=!0,n;a.init=function(b){if(!t){t=!0;j=i("cly_queue")||[];b=b||{};a.debug=b.debug||a.debug||!1;a.app_key=b.app_key||a.app_key||null;var e=a,c;if(!(c=b.device_id))if(!(c=a.device_id)){if(!(c=i("cly_id"))){var f=(new Date).getTime();c="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,
function(b){var a=(f+16*Math.random())%16|0;f=Math.floor(f/16);return("x"==b?a:a&3|8).toString(16)})}i("cly_id",c)}e.device_id=c;e=a;c=b.url||a.url||"https://cloud.count.ly";c="/"==c.substr(c.length-1)?c.substr(0,c.length-1):c;e.url=c;a.app_version=b.app_version||a.app_version||null;a.country_code=b.country_code||a.country_code||null;a.city=b.city||a.city||null;a.ip_address=b.ip_address||a.ip_address||null;a.q=a.q||[];a.q.constructor!==Array&&(a.q=[]);q();i("cly_id",a.device_id);h("Countly initialized")}};
a.begin_session=function(b){m||(h("Session started"),n=p(),m=!0,r=b?!1:!0,b={begin_session:1},i("cly_first_"+a.device_id)||(i("cly_first_"+a.device_id,!0),b.metrics=JSON.stringify(x())),k(b))};a.session_duration=function(b){m&&(h("Session extended",b),k({session_duration:b}))};a.end_session=function(){m&&(h("Ending session"),m=!1,k({end_session:1,session_duration:p()-n}))};a.change_id=function(b){var e=a.device_id;a.device_id=b;i("cly_id",a.device_id);h("Changing id");k({old_device_id:e})};a.add_event=
function(b){b.key?(b.count||(b.count=1),l.push(s(b,["key","count","sum","segmentation"])),h("Adding event: ",b)):h("Event must have key property")};a.user_details=function(b){h("Adding userdetails: ",b);k({user_details:JSON.stringify(s(b,"name username email organization phone picture gender byear custom".split(" ")))})};var i=function(b,a,c){function f(a,b,c){var d=new Date;d.setTime(d.getTime()+864E5*c);c="; expires="+d.toGMTString();document.cookie=a+"="+b+c+"; path=/"}var g=!1,d;localStorage&&
(g=!0);"undefined"!==typeof a&&null!==a&&("object"===typeof a&&(a=JSON.stringify(a)),g?localStorage.setItem(b,a):c||f(b,a,30));if("undefined"===typeof a){if(g)d=localStorage.getItem(b);else if(!c)a:{b+="=";a=document.cookie.split(";");c=0;for(g=a.length;c<g;c++){for(d=a[c];" "===d.charAt(0);)d=d.substring(1,d.length);if(0===d.indexOf(b)){d=d.substring(b.length,d.length);break a}}d=null}try{d=JSON.parse(d)}catch(h){}return d}null===a&&(g?localStorage.removeItem(b):c||f(b,"",-1))}})(window.Countly=
window.Countly||{});
