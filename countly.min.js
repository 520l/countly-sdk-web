(function(b){function m(a){!b.app_key||!b.device_id?e("app_key or device_id is missing"):(a.app_key=b.app_key,a.device_id=b.device_id,b.country_code&&(a.country_code=b.country_code),b.city&&(a.city=b.city),b.ip_address&&(a.ip_address=b.ip_address),a.timestamp=r(),j.push(a),k("cly_queue",j,!0))}function s(){if(b.q&&0<b.q.length){for(var a,d=0;d<b.q.length;d++)if(a=b.q[d],a.constructor===Array&&0<a.length&&(e("Processing queued call",a),b[a[0]]))b[a[0]](a[1]);b.q=[]}p&&t&&(a=r(),60<a-q&&(b.session_duration(a-
q),q=a));0<n.length&&(10>=n.length?(m({events:JSON.stringify(n)}),n=[]):(n.splice(0,10),m({events:JSON.stringify(n)})));if(0<j.length){var c=j.shift();e("Processing request",c);var f=function(a,b){e("Request Finished",b,!1);a&&(j.unshift(b),k("cly_queue",j,!0))};try{e("Sending XML HTTP request");var l=window.XMLHttpRequest?new window.XMLHttpRequest:window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):null;l.open("GET",b.url+x+"?"+y(c),!0);l.onreadystatechange=function(){4===this.readyState&&
200<=this.status&&300>this.status?"function"===typeof f&&f(!1,c):4===this.readyState&&(e("Failed Server XML HTTP request",this.status),"function"===typeof f&&f(!0,c))};l.send()}catch(g){e("Failed XML HTTP request",g),"function"===typeof f&&f(!0,c)}k("cly_queue",j,!0)}setTimeout(s,z)}function A(){var a={};b.app_version&&(a._app_version=b.app_version);screen.width&&(a._resolution=""+(screen.width?screen.width:"")+"x"+(screen.height?screen.height:""));var d=navigator.userAgent,c=navigator.appName;parseFloat(navigator.appVersion);
var f,l;if(-1!=d.indexOf("Opera"))c="Opera";else if(-1!=d.indexOf("MSIE"))c="Internet Explorer";else if(-1!=d.indexOf("Chrome"))c="Chrome";else if(-1!=d.indexOf("Safari"))c="Safari";else if(-1!=d.indexOf("Firefox"))c="Firefox";else if(-1!=d.indexOf("Trident/"))c="Internet Explorer";else if((f=d.lastIndexOf(" ")+1)<(l=d.lastIndexOf("/")))c=d.substring(f,l),c.toLowerCase()==c.toUpperCase()&&(c=navigator.appName);a._carrier=c;c="unknown";f=[{s:"Windows 3.11",r:/Win16/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},
{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},
{s:"Windows ME",r:/Windows ME/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OSX",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"SearchBot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(var g in f)if(l=f[g],l.r.test(d)){c=l.s;break}g="unknown";/Windows/.test(c)&&
(g=/Windows (.*)/.exec(c)[1],c="Windows");switch(c){case "Mac OSX":g=/Mac OS X (10[\.\_\d]+)/.exec(d)[1];break;case "Android":g=/Android ([\.\_\d]+)/.exec(d)[1];break;case "iOS":g=/OS (\d+)_(\d+)_?(\d+)?/.exec(nVer),g=g[1]+"."+g[2]+"."+(g[3]|0)}a._os=c;a._os_version=g;if(d=navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage)a._locale=d;e("Got metrics",a);return a}function e(){b.debug&&console&&console.log(Array.prototype.slice.call(arguments))}function r(){return Math.floor((new Date).getTime()/
1E3)}function y(a){var b=[],c;for(c in a)b.push(c+"="+encodeURIComponent(a[c]));return b.join("&")}function u(a,b){for(var c={},f,l=0;l<b.length;l++)f=b[l],a[f]&&(c[f]=a[f]);return c}var v=!1,p=!1,x="/i",z=500,j=[],n=[],t=!0,q;b.init=function(a){if(!v){v=!0;j=k("cly_queue")||[];a=a||{};b.debug=a.debug||b.debug||!1;b.app_key=a.app_key||b.app_key||null;var d=b,c;if(!(c=a.device_id))if(!(c=b.device_id)){if(!(c=k("cly_id"))){var f=(new Date).getTime();c="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,
function(a){var b=(f+16*Math.random())%16|0;f=Math.floor(f/16);return("x"==a?b:b&3|8).toString(16)})}k("cly_id",c)}d.device_id=c;d=b;c=a.url||b.url||"https://cloud.count.ly";c="/"==c.substr(c.length-1)?c.substr(0,c.length-1):c;d.url=c;b.app_version=a.app_version||b.app_version||null;b.country_code=a.country_code||b.country_code||null;b.city=a.city||b.city||null;b.ip_address=a.ip_address||b.ip_address||null;b.q=b.q||[];b.q.constructor!==Array&&(b.q=[]);s();k("cly_id",b.device_id);e("Countly initialized")}};
b.begin_session=function(a){p||(e("Session started"),q=r(),p=!0,t=a?!1:!0,a={begin_session:1},k("cly_first_"+b.device_id)||(k("cly_first_"+b.device_id,!0),a.metrics=JSON.stringify(A())),m(a))};b.session_duration=function(a){p&&(e("Session extended",a),m({session_duration:a}))};b.end_session=function(){p&&(e("Ending session"),p=!1,m({end_session:1,session_duration:r()-q}))};b.change_id=function(a){var d=b.device_id;b.device_id=a;k("cly_id",b.device_id);e("Changing id");m({old_device_id:d})};b.add_event=
function(a){a.key?(a.count||(a.count=1),n.push(u(a,["key","count","sum","segmentation"])),e("Adding event: ",a)):e("Event must have key property")};b.user_details=function(a){e("Adding userdetails: ",a);m({user_details:JSON.stringify(u(a,"name username email organization phone picture gender byear custom".split(" ")))})};b.track_sessions=function(){function a(){document[d]?b.end_session():b.begin_session()}b.begin_session();i(window,"unload",function(){b.end_session()});var d="hidden";d in document?
document.addEventListener("visibilitychange",a):(d="mozHidden")in document?document.addEventListener("mozvisibilitychange",a):(d="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",a):(d="msHidden")in document?document.addEventListener("msvisibilitychange",a):"onfocusin"in document?(i(window,"focusin",function(){b.begin_session()}),i(window,"focusout",function(){b.end_session()})):(i(window,"focus",function(){b.begin_session()}),i(window,"blur",function(){b.end_session()}),
i(window,"pageshow",function(){b.begin_session()}),i(window,"pagehide",function(){b.end_session()}))};b.track_pageview=function(){b.add_event({key:"pageView",segmentation:{host:window.location.host,path:window.location.pathname,protocol:window.location.protocol,hash:window.location.hash,query:window.location.search,url:window.location.href}})};b.track_clicks=function(a){function d(){if(a.getElementsByTagName)for(var c=a.getElementsByTagName("a"),d=0;d<c.length;d++)i(c[d],"click",function(a){var c;
c=a?a.target?a.target:a.srcElement:window.event.srcElement;"undefined"==typeof a.pageY&&("number"==typeof a.clientX&&document.documentElement)&&(a.pageX=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,a.pageY=a.clientY+document.body.scrollTop+document.documentElement.scrollTop);b.add_event({key:"linkClick",segmentation:{href:c.href,text:c.innerText,id:c.id,x:a.pageX,y:a.pageY}});c.href&&("_blank"!==c.target&&!a.metaKey&&!a.altKey&&!a.ctrlKey&&!a.shiftKey)&&(b.end_session(),
w(a),setTimeout(function(){window.location.href=c.href},1E3))});else e("Can't track clicks")}a=a||document;"complete"===document.readyState?d():i(window,"load",d)};b.track_forms=function(a){function d(a){return a.name||a.id||a.type||a.nodeName}function c(a){var c=!1;i(a,"submit",function(f){if(!c){c=!0;var e={id:a.id,name:a.name,action:a.action,method:a.method},h;if(a.elements)for(var i=0;i<a.elements.length;i++)if(h=a.elements[i],"select"==h.nodeName.toLowerCase())if(h.multiple){var k=[];if(h.options)for(var j=
0;j<h.options.length;j++)h.options[j].selected&&k.push(h.options[j].value);e["input:"+d(h)]=k.join()}else e["input:"+d(h)]=h.options[h.selectedIndex].value;else"input"==h.nodeName.toLowerCase()?h.type?"checkbox"==h.type.toLowerCase()||"radio"==h.type.toLowerCase()?h.checked&&(e["input:"+d(h)]=h.value):e["input:"+d(h)]=h.value:e["input:"+d(h)]=h.value:"textarea"==h.nodeName.toLowerCase()?e["input:"+d(h)]=h.value:h.value&&(e["input:"+d(h)]=h.value);b.add_event({key:"formSubmit",segmentation:e});b.end_session();
w(f);setTimeout(function(){a.submit()},1E3)}})}function f(){if(a.getElementsByTagName)for(var b=a.getElementsByTagName("form"),d=0;d<b.length;d++)c(b[d]);else e("Can't track forms")}a=a||document;"complete"===document.readyState?f():i(window,"load",f)};var i=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)},w=function(a){window.event?window.event.returnValue=!1:a.preventDefault?a.preventDefault():a.returnValue=!1},k=function(a,b,c){function f(a,b,c){var d=new Date;
d.setTime(d.getTime()+864E5*c);c="; expires="+d.toGMTString();document.cookie=a+"="+b+c+"; path=/"}var e=!1,g;localStorage&&(e=!0);"undefined"!==typeof b&&null!==b&&("object"===typeof b&&(b=JSON.stringify(b)),e?localStorage.setItem(a,b):c||f(a,b,30));if("undefined"===typeof b){if(e)g=localStorage.getItem(a);else if(!c)a:{a+="=";b=document.cookie.split(";");c=0;for(e=b.length;c<e;c++){for(g=b[c];" "===g.charAt(0);)g=g.substring(1,g.length);if(0===g.indexOf(a)){g=g.substring(a.length,g.length);break a}}g=
null}try{g=JSON.parse(g)}catch(i){}return g}null===b&&(e?localStorage.removeItem(a):c||f(a,"",-1))}})(window.Countly=window.Countly||{});
